/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import r from"../../../request.js";import e from"../../../core/Error.js";import{parseUrl as s,asValidOptions as i,encode as o}from"../../utils.js";import{addServerVersion as t}from"./serverVersionUtils.js";import n from"./support/DifferencesResult.js";const f=new Map;async function a(a,c,m,p){f.has(a)||await t(f,a);const u=f.get(a);if((u?.serverVersion??0)<=11.1)throw new e("differences:enterprise-version","versioning API requires ArcGIS Enterprise version 11.2 or higher");if(!c)throw new e("differences:missing-guid","guid for version is missing");const g=s(a),h=m.toJSON();m.layers&&(h.layers=JSON.stringify(m.layers));const d=i(g.query,{query:o({...h,f:"json"}),...p,method:"post"});c.startsWith("{")&&(c=c.slice(1,-1));const l=`${g.path}/versions/${c}/differences`,{data:v}=await r(l,d);return n.fromJSON(v)}export{a as differences,f as serverVersionCacheMap};
