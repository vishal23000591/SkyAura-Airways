/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import e from"../../request.js";import t from"../../core/Error.js";import{parseUrl as i,encode as a,asValidOptions as s}from"../utils.js";import r from"./support/ValidateNetworkTopologyResult.js";async function o(t,o,d){const l=i(t),u=o.toJSON();o.validationSet&&(u.validationSet=JSON.stringify(o.validationSet));const c={...u,returnEdits:!0,f:"json"},p=a({...l.query,...c}),f=s(p,{...d,method:"post"}),k=`${l.path}/validateNetworkTopology`,{data:v}=await e(k,f);return r.fromJSON(n(v))}async function d(r,o,d){if(!o.gdbVersion)throw new t("submit-validate-network-topology-job:missing-gdb-version","version is missing");const n=i(r),l=o.toJSON();o.validationSet&&(l.validationSet=JSON.stringify(o.validationSet));const u=s(n.query,{query:a({...l,returnEdits:!0,async:!0,f:"json"}),...d,method:"post"}),c=`${n.path}/validateNetworkTopology`,{data:p}=await e(c,u);return p?p.statusUrl:null}function n(e){return e.serviceEdits&&(e.serviceEdits=e.serviceEdits.map((e=>(e.editedFeatures.spatialReference&&(e.editedFeatures.spatialReference={wkid:e.editedFeatures.spatialReference.wkid,wkt:e.editedFeatures.spatialReference.wkt,wkt2:e.editedFeatures.spatialReference.wkt2,latestWkid:e.editedFeatures.spatialReference.latestWkid,latestVcsWkid:e.editedFeatures.spatialReference.latestVcsWkid,vcsWkid:e.editedFeatures.spatialReference.vcsWkid}),e={layerId:e.id,editedFeatures:e.editedFeatures})))),e}export{n as handleValidateNetworkTopologyResult,d as submitValidateNetworkTopologyJob,o as validateNetworkTopology};
