/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{floatEqualRelative as t,floatEqualAbsolute as n}from"../../../core/mathUtils.js";import{expandPointInPlace as o}from"../aaBoundingRect.js";import{interpolateSegment as r,findClosestAndFurthestCurveParametersToPoint as s,distance2 as c}from"./mathUtils.js";const e=[0,0];function u(t,n,o,r,s){const c=1-s,e=c*c,u=s*s,i=e*c,a=3*s*e,f=3*u*c,m=u*s;return[t[0]*i+n[0]*a+o[0]*f+r[0]*m,t[1]*i+n[1]*a+o[1]*f+r[1]*m]}function i(t,n,o){const r=t,[s,c,e]=n.b;return u(r,c,e,s,o)}function a(t,n,o){const s=t,[c,u,i]=n.b,a=r([0,0],s,u,o),f=r(e,u,i,o),m=r([0,0],i,c,o),h=r([0,0],a,f,o),p=r([0,0],f,m,o);return[{b:[r([],h,p,o),a,h]},{b:[[...c],p,m]}]}function f(o,r,c){const e=o,[i,a,f]=r.b,m=s(c,[.1,.5,.9],(t=>{const n=1-t,[o,r]=u(e,a,f,i,t);return[o,r,3*n*n*(a[0]-e[0])+6*n*t*(f[0]-a[0])+3*t*t*(i[0]-f[0]),3*n*n*(a[1]-e[1])+6*n*t*(f[1]-a[1])+3*t*t*(i[1]-f[1]),6*n*(f[0]-2*a[0]+e[0])+6*t*(i[0]-2*f[0]+a[0]),6*n*(f[1]-2*a[1]+e[1])+6*t*(i[1]-2*f[1]+a[1])]})).map((t=>Math.min(1,Math.max(0,t))));m.push(0,1);let h=1/0;const p=m.map((t=>{const n=u(e,a,f,i,t),[o,r]=n,s=c[0]-o,m=c[1]-r,p=Math.sqrt(s*s+m*m);return h=Math.min(p,h),{t,curvePoint:n,distance:p}})),b=[];for(const s of p){const{t:o,distance:r}=s;t(r,h)&&!b.some((({t})=>n(t,o)))&&b.push(s)}return b}function m(t,n,r){const s=n,[c,e,u]=r.b;return o(t,s),o(t,e),o(t,u),o(t,c),t}function h(t,n,o){const r=16;let s=0,e=[n];for(let u=0;u<r;u++){let n=t;const r=[];for(const t of e)r.push(...a(n,t,.5)),n=t.b[0];e=r,n=t,s=0;let u=0;for(const t of e){const[o,r,e]=t.b,i=Math.sqrt(c(n,o));s+=(i+(Math.sqrt(c(n,r))+Math.sqrt(c(r,e))+Math.sqrt(c(e,o))))/2,u+=i,n=o}if(s-u<o)return s}return s}export{m as bezierCurveExtent,h as bezierCurveLength,f as closestPointsOnBezierCurve,i as interpolateBezierCurve,u as interpolateCubicBezier,a as splitBezierCurve};
