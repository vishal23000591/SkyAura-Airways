/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import"../../core/has.js";import"../../core/RandomLCG.js";import{subclass as l}from"../../core/accessorSupport/decorators/subclass.js";import r from"../Widget.js";import{loadCalciteComponents as o}from"./componentsUtils.js";import"./widgetUtils.js";import{messageBundle as s}from"./decorators/messageBundle.js";import{tsx as a}from"./jsxFactory.js";import n from"./FilterCondition/FilterConditionViewModel.js";const d={},p="esri-filter-condition",u={base:p,valueInputContainer:`${p}__value-input-container`};let c=class extends r{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.viewModel=new n,this.visibleElements={...d}}loadDependencies(){return o({input:()=>import("@esri/calcite-components/dist/components/calcite-input"),option:()=>import("@esri/calcite-components/dist/components/calcite-option"),select:()=>import("@esri/calcite-components/dist/components/calcite-select")})}get _defaultFieldName(){const{fields:e,fieldName:t}=this;return t||(e?.length?e[0].name:void 0)}get _valueInputType(){const{viewModel:e}=this;return e.isNumericField||e.isObjectIDField?"number":"text"}get _visibleOperators(){const{field:e,operators:t,viewModel:i}=this;return e?i.isStringField||i.isGlobalIDField?t.string:i.isNumericField?t.number:i.isObjectIDField?t.id:[]:[]}get _isValueInputHidden(){const{operator:e}=this;return!!e&&["isBlank","isNotBlank","isEmpty","isNotEmpty"].includes(e)}get domain(){return this.viewModel.domain}get field(){return this.viewModel.field}get fields(){return this.viewModel.fields}get fieldLabel(){return this.viewModel.fieldLabel}get fieldName(){return this.viewModel.fieldName}set fieldName(e){this.viewModel.fieldName=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get normalizedFieldName(){return this.viewModel.normalizedFieldName}get operator(){return this.viewModel.operator}set operator(e){this.viewModel.operator=e}get operators(){return this.viewModel.operators}set operators(e){this.viewModel.operators=e}get state(){return this.viewModel.state}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}get valueAsString(){return this.viewModel.valueAsString}castVisibleElements(e){return{...d,...e}}get whereClause(){return this.viewModel.whereClause}render(){return a("div",{class:u.base},this._renderFieldSelection(),this._renderOperatorSelection(),this._renderValueInput())}_renderFieldSelection(){const e=this.normalizedFieldName;return a("div",null,a("calcite-select",{afterCreate:()=>{this.fieldName||(this.fieldName=this._defaultFieldName)},bind:this,label:this.messages.chooseField,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this.value=null,this.fieldName=e.value}},this.fields.map((t=>this._renderOption(t.name,t.alias,e)))))}_renderOperatorSelection(){const{_visibleOperators:e,messages:t,operator:i}=this;if(e.length)return a("div",null,a("calcite-select",{afterUpdate:e=>{const t=e.value;this._visibleOperators.includes(t)||(this.operator=this._visibleOperators[0])},bind:this,label:t.operator,required:!0,width:"full",onCalciteSelectChange:e=>{this.operator=e.currentTarget.value}},e.map((e=>this._renderOption(e,t.operators[e],i)))))}_renderOption(e,t,i){return a("calcite-option",{key:e,label:t??e,selected:e===i,value:e})}_renderValueInput(){const{valueAsString:e,domain:t,messages:i,operator:l}=this;if(!this._isValueInputHidden){if("coded-value"===t?.type&&t.codedValues.length&&("is"===l||"isNot"===l)){const l=t.codedValues[0].code;return a("div",{key:"value-select"},a("calcite-select",{afterCreate:()=>this._afterSelectCreateOrUpdate(l),afterUpdate:()=>this._afterSelectCreateOrUpdate(l),bind:this,label:i.value,required:!0,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this._onValueChange(e.value)}},t.codedValues.map((({code:t,name:i})=>this._renderOption(`${t}`,i,e)))))}return a("div",{class:u.valueInputContainer,key:"value-input"},a("calcite-input",{label:i.value,type:this._valueInputType,value:e,onCalciteInputInput:({currentTarget:e})=>{this._onValueChange(e.value)}}))}}_afterSelectCreateOrUpdate(e){null==this.value&&(this.value=e)}_onValueChange(e){const{viewModel:t}=this;e&&""!==e?t.isStringField||t.isGlobalIDField?this.value=e.toString():(t.isNumericField||t.isObjectIDField)&&(this.value=parseFloat(e)):this.value=null}};e([t()],c.prototype,"_defaultFieldName",null),e([t()],c.prototype,"_valueInputType",null),e([t()],c.prototype,"_visibleOperators",null),e([t()],c.prototype,"_isValueInputHidden",null),e([t()],c.prototype,"domain",null),e([t()],c.prototype,"field",null),e([t()],c.prototype,"fields",null),e([t()],c.prototype,"fieldLabel",null),e([t()],c.prototype,"fieldName",null),e([t()],c.prototype,"layer",null),e([t(),s("esri/widgets/support/FilterCondition/t9n/FilterCondition")],c.prototype,"messages",void 0),e([t(),s("esri/t9n/common")],c.prototype,"messagesCommon",void 0),e([t()],c.prototype,"normalizedFieldName",null),e([t()],c.prototype,"operator",null),e([t()],c.prototype,"operators",null),e([t()],c.prototype,"state",null),e([t()],c.prototype,"value",null),e([t()],c.prototype,"valueAsString",null),e([t()],c.prototype,"viewModel",void 0),e([t()],c.prototype,"visibleElements",void 0),e([i("visibleElements")],c.prototype,"castVisibleElements",null),e([t()],c.prototype,"whereClause",null),c=e([l("esri.widgets.support.FilterCondition")],c);export{c as default};
