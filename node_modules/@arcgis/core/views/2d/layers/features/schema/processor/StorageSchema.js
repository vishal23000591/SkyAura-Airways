/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../../../core/arrayUtils.js";import{internalTrackPartField as i,TrackPart as r}from"../../../../../../layers/support/streamLayerUtils.js";import{VVBinding as n}from"../../../../engine/webgl/enums.js";import{simplifyVisualVariables as t}from"../../support/rendererUtils.js";import{getWebGLCapabilities as s}from"../../../../../webgl/capabilities.js";function a(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:s().maxTextureSize},bindings:u(e)}}function o(e,n){const t=s();return{type:"multi",target:"feature",keyField:i,filters:n,capabilities:{maxTextureSize:t.maxTextureSize},bindings:{[r.TrackLine]:u(e.trackLines.renderer),[r.LatestObservation]:u(e.latestObservations.renderer),[r.PreviousObservation]:u(e.previousObservations.renderer)}}}function l(e){switch(e){case"opacity":return n.OPACITY;case"color":return n.COLOR;case"rotation":return n.ROTATION;case"size":return n.SIZE;default:return null}}function u(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return d(e);case"dot-density":return c(e);case"pie-chart":return p(e);case"heatmap":return f(e)}}function c(e){const i=[];for(const r of e.attributes)i.push({binding:i.length,expression:r.valueExpression,field:r.field});return i}function p(e){const i=d(e);let r=4;for(const n of e.attributes)i.push({binding:r++,expression:n.valueExpression,field:n.field});return i}function f({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function d(i){if(!("visualVariables"in i)||!i.visualVariables?.length)return[];return t(i.visualVariables).map((e=>y(e))).filter(e)}function m(e){return"$view.scale"===e.valueExpression?null:{binding:l(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function b(e){return{binding:l(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function x(e){return{binding:l(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function v(e){return{binding:l(e.type),expression:e.valueExpression,field:e.field}}function y(e){switch(e.type){case"size":return m(e);case"color":return b(e);case"opacity":return x(e);case"rotation":return v(e)}}export{c as createDotDensityBindings,f as createHeatmapBindings,p as createPieChartBindings,a as createStorageSchema,o as createTrackStorageSchema,d as createVVBindings};
