/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../../../../../chunks/tslib.es6.js";import{uniform as s,define as u,option as r,UniformGroup as l}from"../../../../GraphShaderModule.js";import{Vec4 as i,pow as a,Float as e,sqrt as d,Mat3 as p,Vec3 as c}from"../../../../graph/glsl.js";import{oneMinus as m}from"../../utils.js";import{BaseRasterProcessorShader as n}from"./BaseRasterProcessorShader.js";import{roundOutput as o,invertValue as y}from"./math.js";class b extends l{}t([s(p)],b.prototype,"bandIndexMat3",void 0);class h extends l{}t([s(c)],h.prototype,"adjustments",void 0);class x extends n{constructor(){super(...arguments),this.type="BandArithmeticShader",this.isOutputRounded=!1}_process(t){const s=this._getPixel(t),u=this.bandArithmeticConfig.bandIndexMat3.multiply(s.rgb),r=this._processIndex(u),l=new i(r,r,r,s.a);return this.isOutputRounded?o(l):l}_processIndex(t){const{r:s,g:u}=t,r=this.adjustmentConfig?.adjustments;switch(this.indexType){case"ndxi":{const t=s.subtract(u),r=s.add(u);return t.multiply(y(r))}case"sr":return s.multiply(y(u));case"ci":return s.multiply(y(u)).subtract(1);case"savi":{const{x:t}=r,l=s.subtract(u),i=s.add(u).add(t);return l.multiply(y(i)).multiply(t.add(1))}case"tsavi":{const{x:t,y:l,z:i}=r,a=i.multiply(t.multiply(t).add(1)).subtract(l.multiply(t)),e=t.multiply(s.subtract(t.multiply(u)).subtract(l)),d=l.multiply(s).add(u).add(a);return e.multiply(y(d))}case"msavi":{const t=s.multiply(2).add(1),r=t.multiply(t).subtract(s.subtract(u).multiply(8));return t.subtract(d(r)).multiply(.5)}case"gemi":{const t=s.multiply(s).subtract(u.multiply(u)).multiply(2).add(s.multiply(1.5)).add(u.multiply(.5)),r=s.add(u).add(.5),l=t.multiply(y(r)),i=l.multiply(m(l.multiply(.25))),a=u.subtract(.125).multiply(y(m(u)));return i.subtract(a)}case"pvi":{const{x:t,y:l}=r,i=d(t.multiply(t).add(1));return s.subtract(u.multiply(t)).subtract(l).multiply(y(i))}case"vari":{const s=t.g.subtract(t.r),u=t.g.add(t.r).subtract(t.b);return s.multiply(y(u))}case"rtvicore":return s.subtract(u).multiply(100).subtract(s.subtract(t.b).multiply(10));case"bai":{const t=a(new e(.1).subtract(u),new e(2)),r=a(new e(.06).subtract(s),new e(2));return y(t.add(r))}case"evi":{const r=t.b,l=s.add(u.multiply(6)).subtract(r.multiply(7.5)).add(1);return s.subtract(u).multiply(2.5).multiply(y(l))}case"wndwi":{const{r:s,g:u,b:l}=t,i=r.x,a=i.multiply(u),e=i.multiply(l),d=s.add(a).add(l).subtract(e);return s.subtract(a).subtract(l).add(e).multiply(y(d))}case"mtvi":{const r=t.b,l=a(s.multiply(2).add(1),new e(2)),i=s.multiply(6).subtract(d(u).multiply(5)),p=d(l.subtract(i).subtract(.5)),c=s.subtract(r).multiply(1.2),m=u.subtract(r).multiply(2.5);return c.subtract(m).multiply(1.5).multiply(y(p))}default:return s}}}t([u],x.prototype,"indexType",void 0),t([u],x.prototype,"isOutputRounded",void 0),t([s(b)],x.prototype,"bandArithmeticConfig",void 0),t([r(h)],x.prototype,"adjustmentConfig",void 0);export{x as BandArithmeticShader};
