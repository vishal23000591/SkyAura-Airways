/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../../../../../chunks/tslib.es6.js";import{maxMapSizeGpu as o}from"../../../../../../../../../layers/support/rasterFunctions/pixelUtils.js";import{uniform as s,define as e,UniformGroup as r}from"../../../../GraphShaderModule.js";import{Vec3 as i,abs as a,sign as l,step as p,FixedArray as n,Float as u}from"../../../../graph/glsl.js";import{BaseRasterProcessorShader as c}from"./BaseRasterProcessorShader.js";class m extends r{}t([s(n.ofType(u,6))],m.prototype,"includedRanges",void 0),t([s(n.ofType(u,o))],m.prototype,"noDataValues",void 0);class y extends c{constructor(){super(...arguments),this.type="MaskShader",this.isMultiband=!0}_process(t){const o=this._getPixel(t),s=this._computeNoDataFactor(o.r),e=this._computeRangeFactor(o.rgb);let r;if(this.isMultiband){const t=this._computeNoDataFactor(o.g),a=this._computeNoDataFactor(o.b),l=new i(s,t,a).multiply(e);r=l.x.multiply(l.y).multiply(l.z)}else r=s.multiply(e.x);return o.multiply(r)}_computeNoDataFactor(t){const{noDataValues:s}=this.maskConfig;let e=new i(1);for(let r=0;r<o/3;r++){const o=3*r,p=new i(s[o+0],s[o+1],s[o+2]),n=a(l(p.subtract(t)));e=e.multiply(n)}return e.x.multiply(e.y).multiply(e.z)}_computeRangeFactor(t){const{includedRanges:o}=this.maskConfig,s=new i(o[0],o[2],o[4]),e=new i(o[1],o[3],o[5]);return p(s,t).multiply(p(t,e))}}t([e],y.prototype,"isMultiband",void 0),t([s(m)],y.prototype,"maskConfig",void 0);export{y as MaskShader};
