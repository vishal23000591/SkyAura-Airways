/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{identity as t,translate as o,rotate as e,scale as r}from"../../../../../core/libs/gl-matrix-2/math/mat3.js";import{create as i}from"../../../../../core/libs/gl-matrix-2/factories/mat3f32.js";import{toRadian as s}from"../../../../../core/libs/gl-matrix-2/math/common.js";import{tileCoordSize as l}from"../constants.js";import{CollisionJob as m}from"./CollisionJob.js";import{SymbolDeclutterer as n}from"./SymbolDeclutterer.js";import{SymbolRepository as a}from"./SymbolRepository.js";import{writeOpacityToBuffers as c}from"./util.js";import{Visibility as f}from"../style/StyleDefinition.js";function y(i,y){const u=i.transforms.tileUnitsToPixels,b=s(y),j=Math.cos(b),g=Math.sin(b),h=Math.ceil(512*(Math.abs(g)+Math.abs(j)));t(p),o(p,p,[h/2,h/2]),e(p,p,b),o(p,p,[-256,-256]),r(p,p,[1/8,1/8,1]),i.transforms.tileUnitsToPixels=p;const x=[],S=new a(l,x),M=new n("vector-tile",x,S,null,((t,o,e)=>new m(t,o,e,i.styleRepository,i.key.level,y)),((t,o)=>{c(t,o,!1)}),(()=>0),(t=>{const o=i.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!o||o.getValue()!==f.NONE}));x.push(i),S.registerVectorTile(i),M.setScreenSize(h,h),M.continue(1/0),S.unregisterVectorTile(i),i.transforms.tileUnitsToPixels=u}const p=i();export{y as declutterSingleTile};
