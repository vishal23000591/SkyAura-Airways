/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import"../../core/has.js";import{webglDebugEnabled as e}from"./checkWebGLError.js";import{CompressedTextureFormat as r,SizedPixelFormat as t,SizedDepthStencilFormat as s,SizedDepthFormat as a,PixelFormat as c,SizedStencilFormat as n,BufferType as o}from"./enums.js";import{getDataTypeBytes as i}from"./getDataTypeBytes.js";function R(e){const r=e.gl;switch(r.getError()){case r.NO_ERROR:return null;case r.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case r.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case r.INVALID_OPERATION:return"The specified command is not allowed for the current state";case r.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case r.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case r.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function E(e,r){return(e.vertexBuffers.get(r)?.usedMemory??0)/_(e.layout.get(r))}function _(e){return e[0].stride}function u(r,t,s,a,c=0){const n=r.gl;r.bindBuffer(s);for(const o of a){const s=t.get(o.name);if(null==s){console.warn(`There is no location for vertex attribute '${o.name}' defined.`);continue}const a=c*o.stride;if(o.count<=4)n.vertexAttribPointer(s,o.count,o.type,o.normalized,o.stride,o.offset+a),n.enableVertexAttribArray(s),o.divisor>0&&r.gl.vertexAttribDivisor(s,o.divisor);else if(9===o.count)for(let e=0;e<3;e++)n.vertexAttribPointer(s+e,3,o.type,o.normalized,o.stride,o.offset+12*e+a),n.enableVertexAttribArray(s+e),o.divisor>0&&r.gl.vertexAttribDivisor(s+e,o.divisor);else if(16===o.count)for(let e=0;e<4;e++)n.vertexAttribPointer(s+e,4,o.type,o.normalized,o.stride,o.offset+16*e+a),n.enableVertexAttribArray(s+e),o.divisor>0&&r.gl?.vertexAttribDivisor(s+e,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count);if(e()){const e=R(r),t=i(o.type),s=o.offset,c=Math.round(t/s)!==t/s?`. Offset not a multiple of stride. DataType requires ${t} bytes, but descriptor has an offset of ${s}`:"";e&&console.error(`Unable to bind vertex attribute "${o.name}" with baseInstanceOffset ${a}${c}:`,e,o)}}}function A(e,r,t,s){const a=e.gl;e.bindBuffer(t);for(const c of s){const t=r.get(c.name);if(c.count<=4)a.disableVertexAttribArray(t),c.divisor&&c.divisor>0&&e.gl?.vertexAttribDivisor(t,0);else if(9===c.count)for(let r=0;r<3;r++)a.disableVertexAttribArray(t+r),c.divisor&&c.divisor>0&&e.gl?.vertexAttribDivisor(t+r,0);else if(16===c.count)for(let r=0;r<4;r++)a.disableVertexAttribArray(t+r),c.divisor&&c.divisor>0&&e.gl?.vertexAttribDivisor(t+r,0);else console.error("Unsupported vertex attribute element count: "+c.count)}e.unbindBuffer(o.ARRAY_BUFFER)}function G(e){switch(e){case c.ALPHA:case c.LUMINANCE:case c.RED:case c.RED_INTEGER:case t.R8:case t.R8I:case t.R8UI:case t.R8_SNORM:case n.STENCIL_INDEX8:return 1;case c.LUMINANCE_ALPHA:case c.RG:case c.RG_INTEGER:case t.RGBA4:case t.R16F:case t.R16I:case t.R16UI:case t.RG8:case t.RG8I:case t.RG8UI:case t.RG8_SNORM:case t.RGB565:case t.RGB5_A1:case a.DEPTH_COMPONENT16:return 2;case c.RGB:case c.RGB_INTEGER:case t.RGB8:case t.RGB8I:case t.RGB8UI:case t.RGB8_SNORM:case t.SRGB8:case a.DEPTH_COMPONENT24:return 3;case c.RGBA:case c.RGBA_INTEGER:case t.RGBA8:case t.R32F:case t.R11F_G11F_B10F:case t.RG16F:case t.R32I:case t.R32UI:case t.RG16I:case t.RG16UI:case t.RGBA8I:case t.RGBA8UI:case t.RGBA8_SNORM:case t.SRGB8_ALPHA8:case t.RGB9_E5:case t.RGB10_A2UI:case t.RGB10_A2:case a.DEPTH_COMPONENT32F:case s.DEPTH24_STENCIL8:return 4;case s.DEPTH32F_STENCIL8:return 5;case t.RGB16F:case t.RGB16I:case t.RGB16UI:return 6;case t.RG32F:case t.RG32I:case t.RG32UI:case t.RGBA16F:case t.RGBA16I:case t.RGBA16UI:return 8;case t.RGB32F:case t.RGB32I:case t.RGB32UI:return 12;case t.RGBA32F:case t.RGBA32I:case t.RGBA32UI:return 16;case r.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case r.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case r.COMPRESSED_R11_EAC:case r.COMPRESSED_SIGNED_R11_EAC:case r.COMPRESSED_RGB8_ETC2:case r.COMPRESSED_SRGB8_ETC2:case r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case r.COMPRESSED_RG11_EAC:case r.COMPRESSED_SIGNED_RG11_EAC:case r.COMPRESSED_RGBA8_ETC2_EAC:case r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}export{u as bindVertexBufferLayout,G as getBytesPerElementFormat,R as getErrorString,_ as getStride,A as unbindVertexBufferLayout,E as vertexCount};
