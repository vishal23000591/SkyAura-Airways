/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{toStringEnumKey as e}from"./enum.js";import{replace as t}from"../core/string.js";import{UnknownTimeZone as n}from"../core/sql/UnknownTimeZone.js";import{DateTime as r,Zone as s,FixedOffsetZone as i,IANAZone as o}from"luxon";var a;!function(e){e.TimeZoneNotRecognized="TimeZoneNotRecognized"}(a||(a={}));const d={[a.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class u extends Error{constructor(e,n){super(t(d[e],n)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,u)}}function c(e,t,n){return e<t?e-t:e>n?e-n:0}function m(e,t,n){return e<t?t:e>n?n:e}class h{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,n=1,s=0,i=0,o=0,a=0,d){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(s)||isNaN(i)||isNaN(o)||isNaN(a))return null;const u=r.local(e,t).daysInMonth;let f=r.fromObject({day:m(n,1,u),year:e,month:m(t,1,12),hour:m(s,0,23),minute:m(i,0,59),second:m(o,0,59),millisecond:m(a,0,999)},{zone:l(d)});return f=f.plus({months:c(t,1,12),days:c(n,1,u),hours:c(s,0,23),minutes:c(i,0,59),seconds:c(o,0,59),milliseconds:c(a,0,999)}),new h(f)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const r=l(t);return e.isUnknownTimeZone||r===n.instance?h.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new h(e._date.setZone(r))}static dateJSToArcadeDate(e){return new h(r.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){const n=l(t);return new h(r.fromJSDate(e,{zone:n}))}static unknownEpochToArcadeDate(e){return new h(r.fromMillis(e,{zone:n.instance}))}static unknownDateJSToArcadeDate(e){return new h(r.fromMillis(e.getTime(),{zone:n.instance}))}static epochToArcadeDate(e,t="system"){const n=l(t);return new h(r.fromMillis(e,{zone:n}))}static dateTimeToArcadeDate(e){return new h(e)}clone(){return new h(this._date)}changeTimeZone(e){const t=l(e);return h.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const r=l(t);return e.zone===n.instance||r===n.instance?h.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new h(e.setZone(r))}static nowToArcadeDate(e){const t=l(e);return new h(r.fromJSDate(new Date,{zone:t}))}static nowUTCToArcadeDate(){return new h(r.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===n.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new h(this._date.plus(e))}diff(e,t){return this._date.diff(e._date,t)[t]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,t){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:t&&!this.isUnknownTimeZone})}toFormat(e,t){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const t=r.fromISO(e,{setZone:!0});return new h(t)}}function l(t,r=!0){if(t instanceof s)return t;switch(e(t)){case"system":return"system";case"utc":return"UTC";case"unknown":return n.instance}if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const e=i.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(e)return e}const d=o.create(t);if(!d.isValid){if(r)throw new u(a.TimeZoneNotRecognized);return null}return d}export{h as ArcadeDate,u as ArcadeDateError,a as ArcadeDateErrorCodes,d as arcadeDateErrorMessages,l as createDateTimeZone};
